<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Specimen Console ‚ñ∑ Access-Controlled Chapters</title>
  <meta name="description" content="Standalone demo: password-gated chapters with Catbox audio streaming and sci‚Äëfi horror UI." />
  <style>
    :root{ --bg:#070a0f; --panel:#0c1119; --panel2:#0e1420; --muted:#8c98b1; --text:#e6ebf5; --accent:#37e1ff; --danger:#ff5e6b; --ok:#32f0a1; --warn:#ffc95a; --glow: rgba(55,225,255,.35);} 
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;color:var(--text);background:radial-gradient(1200px 800px at 15% -10%,#0e1320 0%,#070a0f 60%,#070a0f 100%);display:grid;place-items:center;overflow:hidden}
    .app{position:relative;width:min(1100px,95vw);padding:22px}
    .app::before{content:"";position:fixed;inset:-10%;background:repeating-linear-gradient(transparent 0 2px,rgba(0,0,0,.22) 2px 3px);pointer-events:none;mix-blend-mode:soft-light;opacity:.5;z-index:100}
    .app::after{content:"";position:fixed;inset:-10%;background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.07"/></svg>');opacity:.4;mix-blend-mode:overlay;animation:noise 0.6s steps(2) infinite;pointer-events:none;z-index:101}
    @keyframes noise{to{transform:translate3d(-2px,1px,0)}}
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    h1{margin:0;font-size:clamp(16px,3.3vw,22px);letter-spacing:.6px;text-shadow:0 0 8px var(--glow)}
    .spacer{flex:1}
    .langbtn{cursor:pointer;background:linear-gradient(180deg, var(--panel) 0%, var(--panel2) 100%);border:1px solid #1a2233;color:var(--text);padding:8px 10px;border-radius:10px;font-weight:800;box-shadow:0 0 0 0 rgba(55,225,255,.0);transition:.15s ease}
    .langbtn.active{border-color:#2b9ab0;box-shadow:0 0 18px 0 var(--glow)}
    .card{background:linear-gradient(180deg, var(--panel) 0%, var(--panel2) 100%);border:1px solid #192233;border-radius:16px;padding:18px 16px;box-shadow:0 10px 40px #0006, inset 0 0 0 1px #0b1320}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .grid5{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    @media (max-width:880px){.grid3{grid-template-columns:1fr}.grid5{grid-template-columns:repeat(2,1fr)}}
    button{cursor:pointer;background:radial-gradient(120% 140% at 50% -40%, #152034 0%, #0c131f 60%);border:1px solid #1a2438;color:var(--text);padding:14px 12px;border-radius:12px;font-weight:800;letter-spacing:.4px;transition:.15s ease;position:relative;overflow:hidden}
    button:hover{border-color:#2a3d60;transform:translateY(-1px)} button:active{transform:translateY(0)}
    .accent{border-color:#2b9ab0;box-shadow:0 0 0 0 var(--glow)} .ghost{background:transparent}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px}
    .muted{color:var(--muted);font-size:13px}
    .title{font-weight:900;font-size:18px;margin:0 0 10px;letter-spacing:.4px;text-shadow:0 0 8px rgba(255,255,255,.05)}
    .hidden{display:none} .back{margin-bottom:12px}
    .status{margin-top:10px;font-size:14px;color:var(--muted)} .ok{color:var(--ok)} .err{color:var(--danger)} .warn{color:var(--warn)}
    audio#player{width:100%; margin-top:8px; display:none;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,8,16,.55);backdrop-filter:blur(3px);z-index:200}
    .modal.show{display:flex}
    .modal .box{width:min(520px,92vw);background:linear-gradient(180deg,#0b121e,#0f1828);border:1px solid #1b2a44;border-radius:14px;padding:16px;box-shadow:0 20px 60px #0008}
    .modal h2{margin:0 0 8px;font-size:18px}
    .modal .field{display:flex;gap:8px;margin-top:10px}
    .modal input{flex:1;background:#0b1220;border:1px solid #1f2a44;border-radius:10px;padding:12px 10px;color:var(--text)}
    .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .banner{position:fixed;top:8px;left:50%;transform:translateX(-50%);background:#0f1a2b;border:1px solid #233553;border-radius:10px;padding:8px 12px;font-size:13px;color:var(--muted);z-index:300;max-width:92vw}
    .banner.hidden{display:none}
    details.diag{margin-top:10px}
    details.diag pre{background:#0b1020;border:1px solid #1f2a44;border-radius:8px;padding:10px;max-height:220px;overflow:auto}
    .grid-bg{position:fixed;inset:-20%;background:linear-gradient(transparent 98%, rgba(55,225,255,.06) 100%), linear-gradient(90deg, transparent 98%, rgba(55,225,255,.06) 100%); background-size: 30px 30px;opacity:.35;filter:drop-shadow(0 0 8px rgba(55,225,255,.12));pointer-events:none;z-index:0}
    .welcome{display:flex;gap:10px;align-items:center;padding:10px 12px;border:1px solid #1b2a44;border-radius:12px;background:linear-gradient(180deg,#0b121e,#0f1828); margin-bottom:10px}
    .welcome b{color:#9be8ff}
  </style>
</head>
<body>
  <div class="grid-bg"></div>
  <div class="app">
    <div id="banner" class="banner hidden"></div>
    <header>
      <h1 data-i18n="app_title">Specimen Console ‚ñ∑ Access-Controlled Chapters</h1>
      <div class="spacer"></div>
      <button id="btn-es" class="langbtn active" title="Espa√±ol">üá™üá∏ ES</button>
      <button id="btn-en" class="langbtn" title="English">üá¨üáß EN</button>
    </header>

    <section id="screen-main" class="card">
      <div class="welcome" id="welcome">
        <span>üß™</span>
        <div id="welcome-text">Bienvenido/a. Selecciona una colecci√≥n. <b>Las contrase√±as no distinguen may√∫sculas/min√∫sculas</b>.</div>
      </div>
      <p class="title" data-i18n="main_menu">Main Menu</p>
      <div class="grid3" id="collections"></div>
      <p class="muted" style="margin-top:12px" data-i18n="subtitle">Choose a collection to view its chapters. (Passwords are NOT case sensitive).</p>
      <details class="diag">
        <summary data-i18n="diag_title">Diagnostics & tests (optional)</summary>
        <div class="row" style="margin-top:8px">
          <button id="btn-audio-test" class="accent" data-i18n="test_audio">Audio test</button>
          <button id="btn-run-tests" data-i18n="run_tests">Run tests</button>
        </div>
        <div class="row" style="align-items:flex-start;justify-content:stretch">
          <pre id="testlog" style="flex:1"></pre>
        </div>
        <p class="muted" data-i18n="metamask_note">If you see a "MetaMask" error in console: this app does <b>not</b> use blockchain. It likely comes from an extension/template. Try incognito or disable extensions.</p>
      </details>
    </section>

    <section id="screen-chapters" class="card hidden">
      <button id="btn-back" class="ghost back" data-i18n="back">‚üµ Back to menu</button>
      <p class="title"><span id="chapters-title"></span></p>
      <div class="grid5" id="chapters"></div>
      <div id="status" class="status"></div>
      <div id="playerArea" class="row" style="margin-top:6px"></div>
    </section>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="box">
      <h2 id="modal-title">Enter password</h2>
      <p class="muted" id="modal-sub">&nbsp;</p>
      <div class="field"><input id="modal-input" type="password" placeholder="Exact password" /></div>
      <div class="actions"><button id="modal-cancel" class="ghost">Cancel</button><button id="modal-ok" class="accent">Confirm</button></div>
      <div id="modal-msg" class="status"></div>
    </div>
  </div>

  <audio id="player" style="display:none"></audio>

  <script>
    // =============== I18N ===============
    const I18N = { es:{ app_title:'Consola del Laboratorio ‚ñ∑ Cap√≠tulos con contrase√±a', main_menu:'Men√∫ principal', subtitle:'Elige una colecci√≥n para ver sus cap√≠tulos. (Las contrase√±as NO distinguen may√∫sculas/min√∫sculas).', diag_title:'Diagn√≥stico y pruebas (opcional)', test_audio:'Probar audio', run_tests:'Ejecutar tests', metamask_note:'Si ves un error de "MetaMask" en consola: esta app <b>no</b> usa blockchain. Es probable que venga de una extensi√≥n/plantilla. Prueba en inc√≥gnito o desact√≠valas.', back:'‚üµ Volver al men√∫', prompt_title:'Introduce la contrase√±a', prompt_hint:'La contrase√±a NO distingue may√∫sculas/min√∫sculas.', prompt_placeholder:'Contrase√±a exacta', prompt_cancel:'Cancelar', prompt_ok:'Confirmar', status_ok:'¬°Correcto! Reproduciendo audio‚Ä¶', status_bad:'Contrase√±a incorrecta üòÖ', chapter:n=>\`Cap√≠tulo \${n}\`, select_chapter:'Selecciona cap√≠tulo', welcome:'Bienvenido/a. Selecciona una colecci√≥n. <b>Las contrase√±as no distinguen may√∫sculas/min√∫sculas</b>.' }, en:{ app_title:'Lab Console ‚ñ∑ Password-Gated Chapters', main_menu:'Main Menu', subtitle:'Choose a collection to view its chapters. (Passwords are NOT case sensitive).', diag_title:'Diagnostics & tests (optional)', test_audio:'Audio test', run_tests:'Run tests', metamask_note:'If you see a "MetaMask" error in console: this app does <b>not</b> use blockchain. It likely comes from an extension/template. Try incognito or disable extensions.', back:'‚üµ Back to menu', prompt_title:'Enter password', prompt_hint:'Password is NOT case sensitive.', prompt_placeholder:'Exact password', prompt_cancel:'Cancel', prompt_ok:'Confirm', status_ok:'Correct! Playing audio‚Ä¶', status_bad:'Wrong password üòÖ', chapter:n=>\`Chapter \${n}\`, select_chapter:'Select chapter', welcome:'Welcome. Pick a collection. <b>Passwords are NOT case sensitive</b>.' } };
    const COLLECTION_KEYS=['Loud Laugh','Mard March','Red Radiance'];
    let LANG = localStorage.getItem('lang')||'es';

    // =============== DOM refs ===============
    const screenMain=document.getElementById('screen-main');
    const screenCh=document.getElementById('screen-chapters');
    const chaptersTitle=document.getElementById('chapters-title');
    const statusBox=document.getElementById('status');
    const backBtn=document.getElementById('btn-back');
    const modal=document.getElementById('modal');
    const modalInput=document.getElementById('modal-input');
    const modalOk=document.getElementById('modal-ok');
    const modalCancel=document.getElementById('modal-cancel');
    const banner=document.getElementById('banner');
    const testlog=document.getElementById('testlog');
    const btnAudioTest=document.getElementById('btn-audio-test');
    const btnRunTests=document.getElementById('btn-run-tests');
    const player=document.getElementById('player');

    function applyI18N(){
      const t=I18N[LANG]; document.documentElement.lang=LANG;
      document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n'); if(t[k]) el.innerHTML=t[k];});
      const wrap=document.getElementById('collections'); wrap.innerHTML='';
      COLLECTION_KEYS.forEach(k=>{ const b=document.createElement('button'); b.className='accent'; b.textContent=k; b.dataset.collection=k; wrap.appendChild(b); });
      buildChapters();
      document.getElementById('modal-title').textContent=t.prompt_title;
      document.getElementById('modal-sub').textContent=t.prompt_hint;
      modalInput.placeholder=t.prompt_placeholder; document.getElementById('modal-cancel').textContent=t.prompt_cancel; document.getElementById('modal-ok').textContent=t.prompt_ok;
      document.getElementById('btn-es').classList.toggle('active',LANG==='es');
      document.getElementById('btn-en').classList.toggle('active',LANG==='en');
      document.getElementById('welcome-text').innerHTML = t.welcome;
    }
    function buildChapters(){ const t=I18N[LANG]; const wrap=document.getElementById('chapters'); wrap.innerHTML=''; for(let i=1;i<=5;i++){ const b=document.createElement('button'); b.className='chapter'; b.dataset.ch=String(i); b.textContent=t.chapter(i); wrap.appendChild(b);} }

    // =============== Passwords & Audio map ===============
    const PASSWORDS={
      'Loud Laugh':['ANDRHOMO16','ETER678901','FAMILIAX','JAZZT333','HUNOKIN'],
      'Mard March':['GARDEN','AGACMR123','TRIUMVIRATE','LADYBOY','CLDBLD642531'],
      'Red Radiance':['ZMORPHS','CARNOFEST1','STORK','HORCUS2','FRESHIFRESH']
    };
    const AUDIO_SAMPLES = {
      es: {
        'Loud Laugh': [
          'https://files.catbox.moe/djiq7n.mp3', /* Cap.1 */
          null, null, null, null
        ],
        'Mard March':   [null, null, null, null, null],
        'Red Radiance': [null, null, null, null, null]
      },
      en: {
        'Loud Laugh':   [null, null, null, null, null],
        'Mard March':   [null, null, null, null, null],
        'Red Radiance': [null, null, null, null, null]
      }
    };
    const USE_CROSS_LANG_FALLBACK=true;
    function resolveSampleUrl(lang, key, idx){ try{ if(AUDIO_SAMPLES[lang] && AUDIO_SAMPLES[lang][key]){ const u=AUDIO_SAMPLES[lang][key][idx]; if(u) return u; } if(USE_CROSS_LANG_FALLBACK){ const other=lang==='es'?'en':'es'; if(AUDIO_SAMPLES[other] && AUDIO_SAMPLES[other][key]){ const u2=AUDIO_SAMPLES[other][key][idx]; if(u2) return u2; } } }catch(_){ } return null; }

    // =============== Player (simple) ===============
    function playSample(url){
      try{ player.pause(); }catch(_){}
      player.removeAttribute('crossorigin');
      player.src=url; player.load();
      player.play().catch(()=>{});
    }

    // =============== UI state & navigation ===============
    function showPlayer(collectionKey, chapterIndex, url){
      const area=document.getElementById('playerArea');
      if(!area) return;
      const label = (LANG==='es'?'Reproductor: ':'Player: ') + `${collectionKey} ¬∑ ${I18N[LANG].chapter(chapterIndex+1)}`;
      area.innerHTML = `<div class="muted">${label}</div>`;
      player.controls = true;
      player.style.display = 'block';
      if(player.parentNode!==area){ area.appendChild(player); }
    }

    let currentCollection=null; let pendingChapterIndex=null;
    function goToMain(){ screenCh.classList.add('hidden'); screenMain.classList.remove('hidden'); status(''); try{player.pause();}catch(_){} player.controls=false; player.style.display='none'; const pa=document.getElementById('playerArea'); if(pa) pa.innerHTML=''; }
    function goToChapters(collection){ currentCollection=collection; chaptersTitle.textContent=`${collection} ¬∑ ${I18N[LANG].select_chapter}`; screenMain.classList.add('hidden'); screenCh.classList.remove('hidden'); status(''); }
    function status(msg, ok=false){ if(!msg){ statusBox.textContent=''; return;} statusBox.innerHTML= ok?`<span class="ok">${msg}</span>`:`<span class="err">${msg}</span>`; }

    // =============== WebAudio synth sounds (fallback) ===============
    let audioCtx=null; function getCtx(){ if(!audioCtx){ const AC=window.AudioContext||window.webkitAudioContext; try{ audioCtx=new AC(); }catch(e){ return {currentTime:0,resume:()=>{},createOscillator:null}; } } if(audioCtx.state==='suspended') audioCtx.resume?.(); return audioCtx; }
    function env(g,t0,a=0.01,d=0.2,s=0.001){ g.gain.setValueAtTime(0.0001,t0); g.gain.exponentialRampToValueAtTime(0.35,t0+a); g.gain.exponentialRampToValueAtTime(s,t0+a+d); }
    function tone(type,f,t0,d){ const ctx=getCtx(); if(!ctx.createOscillator) return; const o=ctx.createOscillator(); const g=ctx.createGain(); o.type=type; o.frequency.setValueAtTime(f,t0); env(g,t0,0.02,d*0.8,0.001); o.connect(g).connect(ctx.destination); o.start(t0); o.stop(t0+d); }
    function noiseBurst(t0,d,gain=0.2){ const ctx=getCtx(); if(!ctx.createBuffer) return; const size=Math.floor(d*(ctx.sampleRate||44100)); const buf=ctx.createBuffer(1,size,ctx.sampleRate||44100); const data=buf.getChannelData(0); for(let i=0;i<size;i++) data[i]=(Math.random()*2-1)*(1-i/size); const src=ctx.createBufferSource(); src.buffer=buf; const g=ctx.createGain(); g.gain.setValueAtTime(gain,t0); g.gain.exponentialRampToValueAtTime(0.001,t0+d); src.connect(g).connect(ctx.destination); src.start(t0); src.stop(t0+d); }
    function playUISound(){ const now=getCtx().currentTime||0; tone('triangle',880,now,0.06); tone('sine',660,now+0.03,0.05); }
    function playFart(){ const ctx=getCtx(); const now=ctx.currentTime||0; noiseBurst(now,0.35,0.25); if(!ctx.createOscillator) return; const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='sawtooth'; o.frequency.setValueAtTime(120,now); o.frequency.exponentialRampToValueAtTime(40,now+0.35); g.gain.setValueAtTime(0.22,now); g.gain.exponentialRampToValueAtTime(0.001,now+0.38); o.connect(g).connect(ctx.destination); o.start(now); o.stop(now+0.38); }
    function playSuccessSound(collectionKey,chapterIndex){ const url=resolveSampleUrl(LANG,collectionKey,chapterIndex); if(url){ status(LANG==='es'?'Reproduciendo audio personalizado‚Ä¶':'Playing custom audio‚Ä¶',true); playSample(url); return; } const ctx=getCtx(); const now=ctx.currentTime||0; const ch=chapterIndex; if(collectionKey==='Loud Laugh'){ let t=now+0.02; const count=5+ch; for(let i=0;i<count;i++){ const base=240+ch*20; tone('square',base+i*8,t,0.13); t+=0.10+ch*0.01; } } else if(collectionKey==='Mard March'){ const bpm=[90,100,110,120,130][ch]; const step=60/bpm; let t=now; for(let i=0;i<8;i++){ tone('sine',80,t,0.10); noiseBurst(t+step*0.5,0.08,0.2); t+=step; } } else if(collectionKey==='Red Radiance'){ const scales=[[523,659,784],[494,622,740],[587,740,880],[659,830,988],[698,880,1047]]; const seq=scales[ch]; let t=now; const dur=0.16; for(let i=0;i<6;i++){ const f=seq[i%seq.length]; tone('triangle',f,t,dur); t+=0.13; } } }

    // =============== Password modal ===============
    function openPasswordModal(collection, chapterIndex){ pendingChapterIndex=chapterIndex; const t=I18N[LANG]; document.getElementById('modal-title').textContent=`${t.prompt_title} ¬∑ ${collection} ¬∑ ${t.chapter(chapterIndex+1)}`; document.getElementById('modal-sub').textContent=t.prompt_hint; modalInput.value=''; document.getElementById('modal-msg').textContent=''; modal.classList.add('show'); modalInput.focus(); }
    function closePasswordModal(){ modal.classList.remove('show'); pendingChapterIndex=null; }
    function verifyPassword(){ if(currentCollection==null || pendingChapterIndex==null) return; const idx=pendingChapterIndex; const expected=PASSWORDS[currentCollection][idx]; const given=modalInput.value; if((given||'').toLowerCase() === (expected||'').toLowerCase()){ const url=resolveSampleUrl(LANG,currentCollection,idx); status(I18N[LANG].status_ok,true); try{ if(url){ playSample(url); showPlayer(currentCollection, idx, url); } else { playSuccessSound(currentCollection,idx); } }catch(e){ status('Audio blocked. Use "'+I18N[LANG].test_audio+'".',false);} closePasswordModal(); } else { document.getElementById('modal-msg').innerHTML=`<span class="err">${I18N[LANG].status_bad}</span>`; try{ playFart(); }catch(_){} } }
    modalOk.addEventListener('click',verifyPassword); modalCancel.addEventListener('click',closePasswordModal); modalInput.addEventListener('keydown',e=>{ if(e.key==='Enter') verifyPassword(); if(e.key==='Escape') closePasswordModal(); });

    // =============== Events ===============
    document.getElementById('btn-es').addEventListener('click',()=>{LANG='es'; localStorage.setItem('lang','es'); applyI18N();});
    document.getElementById('btn-en').addEventListener('click',()=>{LANG='en'; localStorage.setItem('lang','en'); applyI18N();});
    document.getElementById('collections').addEventListener('click',e=>{ const b=e.target.closest('button[data-collection]'); if(!b) return; goToChapters(b.dataset.collection); });
    backBtn.addEventListener('click',goToMain);
    document.getElementById('chapters').addEventListener('click',e=>{ const b=e.target.closest('button.chapter'); if(!b||!currentCollection) return; const idx=parseInt(b.dataset.ch,10)-1; openPasswordModal(currentCollection,idx); });
    document.addEventListener('click',e=>{ const b=e.target.closest('button'); if(!b) return; try{playUISound();}catch(_){ } },true);

    // =============== MetaMask noise suppression ===============
    function isWalletNoise(msg){ const m=String(msg||'').toLowerCase(); return m.includes('metamask')||m.includes('wallet')||m.includes('ethereum'); }
    function showWalletBanner(){ const note=LANG==='es'?'Aviso: detectado error relacionado con MetaMask/Wallet. Esta p√°gina no usa web3. Prueba en modo inc√≥gnito o desactiva extensiones.':'Heads up: MetaMask/Wallet-related error detected. This page does not use web3. Try incognito or disable extensions.'; banner.textContent='‚ö†Ô∏è '+note; banner.classList.remove('hidden'); clearTimeout(showWalletBanner._t); showWalletBanner._t=setTimeout(()=>banner.classList.add('hidden'),10000); }
    window.addEventListener('error',e=>{ const msg=e?.message||e?.error||''; if(isWalletNoise(msg)){ showWalletBanner(); e.preventDefault(); }});
    window.addEventListener('unhandledrejection',e=>{ const msg=(e?.reason&&(e.reason.message||e.reason))||''; if(isWalletNoise(msg)){ showWalletBanner(); e.preventDefault(); }});

    // =============== Tests ===============
    function assert(c,m){ if(!c) throw new Error(m||'Assert'); }
    function clearLog(){ testlog.textContent=''; }
    function logTest(n,l,e=false){ testlog.textContent+=\`\${n}: \${l}\n\`; if(e) console.error(n+\": \"+l); }

    btnAudioTest?.addEventListener('click',()=>{ try{ getCtx().resume?.(); playSuccessSound('Loud Laugh',0); logTest('AudioTest','PASS: audio reproducido'); }catch(err){ logTest('AudioTest','FAIL: '+err.message,true);} });
    btnRunTests?.addEventListener('click',()=>{
      clearLog();
      try{ assert(!!document.getElementById('screen-main'),'#screen-main no existe'); assert(!!document.getElementById('screen-chapters'),'#screen-chapters no existe'); logTest('DOM','PASS'); }catch(err){ logTest('DOM','FAIL: '+err.message,true); }
      try{ const prev=LANG; LANG='en'; applyI18N(); assert(document.querySelector('[data-i18n="main_menu"]').textContent.toLowerCase().includes('main')); LANG='es'; applyI18N(); assert(document.querySelector('[data-i18n="main_menu"]').textContent.toLowerCase().includes('men√∫')); LANG=prev; applyI18N(); logTest('I18N','PASS'); }catch(err){ logTest('I18N','FAIL: '+err.message,true); }
      try{ applyI18N(); const firstBtn=document.querySelector('#collections button'); assert(!!firstBtn,'No se generaron colecciones'); goToChapters(firstBtn.dataset.collection); assert(!screenCh.classList.contains('hidden')); assert(document.querySelectorAll('#chapters .chapter').length===5); goToMain(); logTest('Navegaci√≥n','PASS'); }catch(err){ logTest('Navegaci√≥n','FAIL: '+err.message,true); }
      try{ // Case-insensitive check: andrhomo16 should match ANDRHOMO16
        const prevLang=LANG; LANG='es'; applyI18N();
        currentCollection='Loud Laugh'; openPasswordModal(currentCollection,0);
        modalInput.value='andrhomo16';
        let ok=false; const _status=status; status=(m)=>{ ok=true; _status(m,true); };
        verifyPassword(); status=_status; assert(ok,'Case-insensitive password failed');
        LANG=prevLang; applyI18N();
        logTest('CaseInsensitivePassword','PASS');
      }catch(err){ logTest('CaseInsensitivePassword','FAIL: '+err.message,true); }
    });

    // Init
    applyI18N();
  </script>
</body>
</html>
