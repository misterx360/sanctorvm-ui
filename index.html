<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Specimen Console â–· Accessâ€‘Controlled Chapters</title>
<meta name="description" content="Standalone demo: password-gated chapters with Catbox audio and sciâ€‘fi UI." />
<style>
:root{--bg:#070a0f;--panel:#0c1119;--panel2:#0e1420;--muted:#8c98b1;--text:#e6ebf5;--accent:#37e1ff;--danger:#ff5e6b;--ok:#32f0a1;--warn:#ffc95a;--glow:rgba(55,225,255,.35)}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:ui-monospace,Menlo,Consolas,monospace;color:var(--text);background:radial-gradient(1200px 800px at 15% -10%,#0e1320 0%,#070a0f 60%,#070a0f 100%);display:grid;place-items:center;overflow:hidden}
.app{position:relative;width:min(1100px,95vw);padding:22px}
header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
h1{margin:0;font-size:clamp(16px,3.3vw,22px);letter-spacing:.6px;text-shadow:0 0 8px var(--glow)}
.spacer{flex:1}.langbtn{cursor:pointer;background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);border:1px solid #1a2233;color:var(--text);padding:8px 10px;border-radius:10px;font-weight:800}.langbtn.active{border-color:#2b9ab0;box-shadow:0 0 18px 0 var(--glow)}
.card{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);border:1px solid #192233;border-radius:16px;padding:18px 16px;box-shadow:0 10px 40px #0006,inset 0 0 0 1px #0b1320}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}.grid5{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
@media(max-width:880px){.grid3{grid-template-columns:1fr}.grid5{grid-template-columns:repeat(2,1fr)}}
button{cursor:pointer;background:radial-gradient(120% 140% at 50% -40%,#152034 0%,#0c131f 60%);border:1px solid #1a2438;color:var(--text);padding:14px 12px;border-radius:12px;font-weight:800;letter-spacing:.4px;transition:.15s ease}
button:hover{border-color:#2a3d60;transform:translateY(-1px)}button:active{transform:translateY(0)}.accent{border-color:#2b9ab0}
.row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px}
.muted{color:var(--muted);font-size:13px}.title{font-weight:900;font-size:18px;margin:0 0 10px}
.hidden{display:none}.back{margin-bottom:12px}.status{margin-top:10px;font-size:14px;color:var(--muted)}.ok{color:var(--ok)}.err{color:var(--danger)}
audio#player{width:100%;margin-top:8px;display:none}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,8,16,.55);backdrop-filter:blur(3px);z-index:200}
.modal.show{display:flex}.modal .box{width:min(520px,92vw);background:linear-gradient(180deg,#0b121e,#0f1828);border:1px solid #1b2a44;border-radius:14px;padding:16px;box-shadow:0 20px 60px #0008}
.modal h2{margin:0 0 8px;font-size:18px}.modal .field{display:flex;gap:8px;margin-top:10px}.modal input{flex:1;background:#0b1220;border:1px solid #1f2a44;border-radius:10px;padding:12px 10px;color:var(--text)}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
.welcome{display:flex;gap:10px;align-items:center;padding:10px 12px;border:1px solid #1b2a44;border-radius:12px;background:linear-gradient(180deg,#0b121e,#0f1828);margin-bottom:10px}
.welcome b{color:#9be8ff}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1 data-i18n="app_title">Specimen Console â–· Access-Controlled Chapters</h1>
    <div class="spacer"></div>
    <button id="btn-es" class="langbtn active" title="EspaÃ±ol">ðŸ‡ªðŸ‡¸ ES</button>
    <button id="btn-en" class="langbtn" title="English">ðŸ‡¬ðŸ‡§ EN</button>
  </header>

  <section id="screen-main" class="card">
    <div class="welcome"><span>ðŸ§ª</span><div id="welcome-text">Bienvenido/a. Selecciona una colecciÃ³n. <b>Las contraseÃ±as no distinguen mayÃºsculas/minÃºsculas</b>.</div></div>
    <p class="title" data-i18n="main_menu">Main Menu</p>
    <div class="grid3" id="collections"></div>
    <p class="muted" style="margin-top:12px" data-i18n="subtitle">Choose a collection to view its chapters. (Passwords are NOT case sensitive).</p>
  </section>

  <section id="screen-chapters" class="card hidden">
    <button id="btn-back" class="back">âŸµ <span data-i18n="back">Back to menu</span></button>
    <p class="title"><span id="chapters-title"></span></p>
    <div class="grid5" id="chapters"></div>
    <div id="status" class="status"></div>
    <div id="playerArea" class="row" style="margin-top:6px"></div>
  </section>
</div>

<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="box">
    <h2 id="modal-title">Enter password</h2>
    <p class="muted" id="modal-sub">&nbsp;</p>
    <div class="field"><input id="modal-input" type="password" placeholder="Exact password" /></div>
    <div class="actions"><button id="modal-cancel" class="accent">Cancel</button><button id="modal-ok" class="accent">Confirm</button></div>
    <div id="modal-msg" class="status"></div>
  </div>
</div>

<audio id="player"></audio>

<script>
// ===== I18N =====
const I18N={
  es:{app_title:'Consola del Laboratorio â–· CapÃ­tulos con contraseÃ±a',main_menu:'MenÃº principal',subtitle:'Elige una colecciÃ³n para ver sus capÃ­tulos. (Las contraseÃ±as NO distinguen mayÃºsculas/minÃºsculas).',back:'Volver al menÃº',prompt_title:'Introduce la contraseÃ±a',prompt_hint:'La contraseÃ±a NO distingue mayÃºsculas/minÃºsculas.',prompt_placeholder:'ContraseÃ±a exacta',prompt_cancel:'Cancelar',prompt_ok:'Confirmar',status_ok:'Â¡Correcto! Reproduciendo audioâ€¦',status_bad:'ContraseÃ±a incorrecta ðŸ˜…',chapter:n=>`CapÃ­tulo ${n}`,select_chapter:'Selecciona capÃ­tulo',welcome:'Bienvenido/a. Selecciona una colecciÃ³n. <b>Las contraseÃ±as no distinguen mayÃºsculas/minÃºsculas</b>.'},
  en:{app_title:'Lab Console â–· Password-Gated Chapters',main_menu:'Main Menu',subtitle:'Choose a collection to view its chapters. (Passwords are NOT case sensitive).',back:'Back to menu',prompt_title:'Enter password',prompt_hint:'Password is NOT case sensitive.',prompt_placeholder:'Exact password',prompt_cancel:'Cancel',prompt_ok:'Confirm',status_ok:'Correct! Playing audioâ€¦',status_bad:'Wrong password ðŸ˜…',chapter:n=>`Chapter ${n}`,select_chapter:'Select chapter',welcome:'Welcome. Pick a collection. <b>Passwords are not case sensitive</b>.'}
};
const COLLECTION_KEYS=['Loud Laugh','Mard March','Red Radiance'];
let LANG=localStorage.getItem('lang')||'es';

// ===== DOM =====
const screenMain=document.getElementById('screen-main');
const screenCh=document.getElementById('screen-chapters');
const chaptersTitle=document.getElementById('chapters-title');
const statusBox=document.getElementById('status');
const backBtn=document.getElementById('btn-back');
const modal=document.getElementById('modal');
const modalInput=document.getElementById('modal-input');
const modalOk=document.getElementById('modal-ok');
const modalCancel=document.getElementById('modal-cancel');
const player=document.getElementById('player');

function applyI18N(){
  const t=I18N[LANG]; document.documentElement.lang=LANG;
  document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n'); if(t[k]) el.textContent=t[k];});
  document.getElementById('welcome-text').innerHTML=t.welcome;
  const wrap=document.getElementById('collections'); wrap.innerHTML='';
  COLLECTION_KEYS.forEach(k=>{ const b=document.createElement('button'); b.className='accent'; b.textContent=k; b.dataset.collection=k; wrap.appendChild(b); });
  buildChapters();
  document.getElementById('modal-title').textContent=t.prompt_title;
  document.getElementById('modal-sub').textContent=t.prompt_hint;
  modalInput.placeholder=t.prompt_placeholder; modalCancel.textContent=t.prompt_cancel; modalOk.textContent=t.prompt_ok;
  document.getElementById('btn-es').classList.toggle('active',LANG==='es');
  document.getElementById('btn-en').classList.toggle('active',LANG==='en');
}
function buildChapters(){ const t=I18N[LANG]; const wrap=document.getElementById('chapters'); wrap.innerHTML=''; for(let i=1;i<=5;i++){ const b=document.createElement('button'); b.className='chapter'; b.dataset.ch=String(i); b.textContent=t.chapter(i); wrap.appendChild(b);} }

// ===== Passwords & Audio =====
const PASSWORDS={
  'Loud Laugh':['ANDRHOMO16','ETER678901','FAMILIAX','JAZZT333','HUNOKIN'],
  'Mard March':['GARDEN','AGACMR123','TRIUMVIRATE','LADYBOY','CLDBLD642531'],
  'Red Radiance':['ZMORPHS','CARNOFEST1','STORK','HORCUS2','FRESHIFRESH']
};
const AUDIO_SAMPLES={
  es:{'Loud Laugh':['https://files.catbox.moe/djiq7n.mp3',null,null,null,null],'Mard March':[null,null,null,null,null],'Red Radiance':[null,null,null,null,null]},
  en:{'Loud Laugh':[null,null,null,null,null],'Mard March':[null,null,null,null,null],'Red Radiance':[null,null,null,null,null]}
};
const USE_CROSS_LANG_FALLBACK=true;
function resolveSampleUrl(lang,key,idx){
  if(AUDIO_SAMPLES[lang]?.[key]?.[idx]) return AUDIO_SAMPLES[lang][key][idx];
  if(USE_CROSS_LANG_FALLBACK){ const other=lang==='es'?'en':'es'; if(AUDIO_SAMPLES[other]?.[key]?.[idx]) return AUDIO_SAMPLES[other][key][idx]; }
  return null;
}

// ===== Player =====
function playSample(url){ try{player.pause();}catch(_){} player.src=url; player.load(); player.play().catch(()=>{}); }
function showPlayer(collectionKey,chapterIndex){
  const area=document.getElementById('playerArea'); if(!area) return;
  const label=(LANG==='es'?'Reproductor: ':'Player: ')+`${collectionKey} Â· ${I18N[LANG].chapter(chapterIndex+1)}`;
  area.innerHTML=`<div class="muted">${label}</div>`; player.controls=true; player.style.display='block'; if(player.parentNode!==area) area.appendChild(player);
}

// ===== State & UI =====
let currentCollection=null,pendingChapterIndex=null;
function status(msg,ok=false){ statusBox.innerHTML=msg? (ok?`<span class="ok">${msg}</span>`:`<span class="err">${msg}</span>`):''; }
function goToMain(){ screenCh.classList.add('hidden'); screenMain.classList.remove('hidden'); status(''); try{player.pause();}catch(_){} player.controls=false; player.style.display='none'; document.getElementById('playerArea').innerHTML=''; }
function goToChapters(collection){ currentCollection=collection; chaptersTitle.textContent=`${collection} Â· ${I18N[LANG].select_chapter}`; screenMain.classList.add('hidden'); screenCh.classList.remove('hidden'); status(''); }

// ===== Simple UI sounds =====
let audioCtx=null; function getCtx(){ if(!audioCtx){ const AC=window.AudioContext||window.webkitAudioContext; try{audioCtx=new AC();}catch(e){return {currentTime:0,createOscillator:null};} } if(audioCtx.state==='suspended') audioCtx.resume?.(); return audioCtx; }
function tone(type,f,t0,d){ const ctx=getCtx(); if(!ctx.createOscillator) return; const o=ctx.createOscillator(); const g=ctx.createGain(); o.type=type; o.frequency.setValueAtTime(f,t0); g.gain.setValueAtTime(0.0001,t0); g.gain.exponentialRampToValueAtTime(0.35,t0+0.02); g.gain.exponentialRampToValueAtTime(0.001,t0+d*0.9); o.connect(g).connect(ctx.destination); o.start(t0); o.stop(t0+d); }
function playUISound(){ const t=getCtx().currentTime||0; tone('triangle',880,t,0.06); tone('sine',660,t+0.03,0.05); }
function playFart(){ const t=getCtx().currentTime||0; tone('sawtooth',120,t,0.38); }

// ===== Password modal =====
function openPasswordModal(collection,chapterIndex){
  pendingChapterIndex=chapterIndex;
  const t=I18N[LANG];
  document.getElementById('modal-title').textContent=`${t.prompt_title} Â· ${collection} Â· ${t.chapter(chapterIndex+1)}`;
  document.getElementById('modal-sub').textContent=t.prompt_hint;
  modalInput.value=''; document.getElementById('modal-msg').textContent='';
  modal.classList.add('show'); modalInput.focus();
}
function closePasswordModal(){ modal.classList.remove('show'); pendingChapterIndex=null; }
function verifyPassword(){
  if(currentCollection==null || pendingChapterIndex==null) return;
  const idx=pendingChapterIndex, expected=PASSWORDS[currentCollection][idx], given=modalInput.value;
  if((given||'').toLowerCase()===(expected||'').toLowerCase()){
    const url=resolveSampleUrl(LANG,currentCollection,idx);
    status(I18N[LANG].status_ok,true);
    if(url){ playSample(url); showPlayer(currentCollection,idx); } else { playUISound(); } // fallback
    closePasswordModal();
  }else{
    document.getElementById('modal-msg').innerHTML=`<span class="err">${I18N[LANG].status_bad}</span>`; playFart();
  }
}

// ===== Events =====
document.getElementById('btn-es').addEventListener('click',()=>{LANG='es';localStorage.setItem('lang','es');applyI18N();});
document.getElementById('btn-en').addEventListener('click',()=>{LANG='en';localStorage.setItem('lang','en');applyI18N();});
document.getElementById('collections').addEventListener('click',e=>{const b=e.target.closest('button[data-collection]'); if(!b) return; playUISound(); goToChapters(b.dataset.collection);});
backBtn.addEventListener('click',()=>{playUISound(); goToMain();});
document.getElementById('chapters').addEventListener('click',e=>{const b=e.target.closest('button.chapter'); if(!b||!currentCollection) return; playUISound(); const idx=parseInt(b.dataset.ch,10)-1; openPasswordModal(currentCollection,idx);});
modalOk.addEventListener('click',verifyPassword); modalCancel.addEventListener('click',closePasswordModal);
modalInput.addEventListener('keydown',e=>{ if(e.key==='Enter') verifyPassword(); if(e.key==='Escape') closePasswordModal(); });

// Init
applyI18N();
</script>
</body>
</html>

